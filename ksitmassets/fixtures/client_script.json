[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Asset",
  "enabled": 1,
  "modified": "2025-11-11 11:51:39.038131",
  "module": "ksitmassets",
  "name": "hide/remove scrap asset option",
  "script": "\nfrappe.ui.form.on(\"Asset\", {\n    refresh(frm) {\n        setTimeout(() => {\n\n            // Remove default scrap button\n            frm.page.remove_inner_button(__('Scrap Asset'), __('Manage'));\n\n            // Add custom Asset Disposal button\n            frm.page.add_inner_button(__('Asset Disposal'), () => {\n\n                frappe.new_doc(\"Asset Disposal\", {\n                    asset_id: frm.doc.name   // <-- This fills asset_id correctly\n                });\n\n            }, __('Manage'));\n\n        }, 100);\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Asset Return",
  "enabled": 1,
  "modified": "2025-11-03 16:49:25.437649",
  "module": "ksitmassets",
  "name": "All asset fetches in asset return",
  "script": "frappe.ui.form.on(\"Asset Return\", {\n    employee_id: function(frm) {\n        if (!frm.doc.employee_id) return;\n\n        frappe.call({\n            method: \"ksitmassets.ksitmassets.doctype.asset_return.asset_return.get_issued_assets\",\n            args: { employee_id: frm.doc.employee_id },\n            callback: function(r) {\n                frm.clear_table(\"assets\");\n\n                if (r.message && r.message.length) {\n                    r.message.forEach(d => {\n                        let row = frm.add_child(\"assets\");\n                        row.asset_id = d.asset_id;\n                        row.asset_name = d.asset_name;\n                        row.condition_at_return = d.condition_at_return;\n                        row.remarks = d.remarks;\n                    });\n\n                    // Refresh table and grid interactivity\n                    frm.refresh_field(\"assets\");\n\n                    //  Force grid to become editable\n                    frappe.utils.delay(300).then(() => {\n                        frm.fields_dict[\"assets\"].grid.refresh();\n                        frm.fields_dict[\"assets\"].grid.update_docfield_property('asset_id', 'read_only', 0);\n                        frm.fields_dict[\"assets\"].grid.df.read_only = 0;\n                        frm.fields_dict[\"assets\"].grid.wrapper.find('.grid-delete-row').show();\n                    });\n\n                    frappe.msgprint(`${r.message.length} asset(s) fetched. You can delete the ones not being returned.`);\n                } else {\n                    frappe.msgprint(\"No issued assets found for this employee.\");\n                }\n            }\n        });\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Asset Return",
  "enabled": 1,
  "modified": "2025-11-04 12:50:46.912286",
  "module": "ksitmassets",
  "name": "asset return",
  "script": "frappe.ui.form.on('Asset Return', {\n    refresh: function(frm) {\n        if (frm.doc.workflow_state === 'Approved' && frm.doc.docstatus === 1) {\n            frm.add_custom_button(__('Go to Asset Movement'), function() {\n                // Collect all assets from child table\n                let assets_list = [];\n                \n                if (frm.doc.assets && frm.doc.assets.length > 0) {\n                    frm.doc.assets.forEach(function(row) {\n                        assets_list.push({\n                            'asset': row.asset_id,\n                            'from_employee': frm.doc.employee_id\n                        });\n                    });\n                }\n                \n                // Validate\n                if (assets_list.length === 0) {\n                    frappe.msgprint(__('No assets to return'));\n                    return;\n                }\n                \n                // Store in sessionStorage\n                sessionStorage.setItem('asset_return_to_movement', JSON.stringify({\n                    assets: assets_list,\n                    employee: frm.doc.employee_id,\n                    purpose: 'Receipt',\n                    reference_doctype: 'Asset Return',\n                    reference_name: frm.doc.name,\n                    transaction_date: frappe.datetime.now_date()\n                }));\n                \n                // Navigate to Asset Movement\n                frappe.new_doc('Asset Movement');\n            }).addClass('btn-primary');\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Asset Movement",
  "enabled": 1,
  "modified": "2025-11-04 12:53:26.159231",
  "module": "ksitmassets",
  "name": "asset_movement_populate_from_return",
  "script": "frappe.ui.form.on('Asset Movement', {\n    onload: function(frm) {\n        let return_data = sessionStorage.getItem('asset_return_to_movement');\n        \n        if (return_data) {\n            let data = JSON.parse(return_data);\n            \n            // Set header fields\n            frm.set_value('purpose', data.purpose);\n            frm.set_value('reference_doctype', data.reference_doctype);\n            frm.set_value('reference_name', data.reference_name);\n            frm.set_value('transaction_date', data.transaction_date);\n            \n            // Clear existing rows first\n            frm.clear_table('assets');\n            \n            // Add assets to child table\n            data.assets.forEach(function(item) {\n                let row = frm.add_child('assets');\n                row.asset = item.asset;\n                row.from_employee = item.from_employee;\n            });\n            \n            frm.refresh_field('assets');\n            \n            // Clear storage\n            sessionStorage.removeItem('asset_return_to_movement');\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Asset Issue Requests",
  "enabled": 1,
  "modified": "2025-11-15 12:02:33.671433",
  "module": "ksitmassets",
  "name": "Asset issue requets to asset movement",
  "script": "frappe.ui.form.on('Asset Issue Requests', {\n    refresh: function(frm) {\n        if (frm.doc.workflow_state === 'Approved' && frm.doc.docstatus === 1) {\n            frm.add_custom_button(__('Go to Asset Movement'), function() {\n                create_asset_movement_doc(frm);\n            }).addClass('btn-primary');\n        }\n    }\n});\n\nfunction create_asset_movement_doc(frm) {\n    // Prepare assets array from the child table\n    let assets_array = [];\n    \n    if (frm.doc.asset_issue_table && frm.doc.asset_issue_table.length > 0) {\n        frm.doc.asset_issue_table.forEach(function(row) {\n            assets_array.push({\n                'asset': row.asset_id,\n                'asset_name': row.asset_name,\n                'to_employee': frm.doc.employee\n            });\n        });\n    } else {\n        frappe.msgprint(__('No assets found in the Asset Issue Request'));\n        return;\n    }\n    \n    // Call server-side method to create Asset Movement\n    frappe.call({\n        method: 'frappe.client.insert',\n        args: {\n            doc: {\n                doctype: 'Asset Movement',\n                purpose: 'Issue',\n                transaction_date: frm.doc.requested_date,\n                reference_doctype: 'Asset Issue Requests',\n                reference_name: frm.doc.name,\n                assets: assets_array\n            }\n        },\n        callback: function(r) {\n            if (!r.exc) {\n                frappe.msgprint(__('Asset Movement created successfully'));\n                frappe.set_route('Form', 'Asset Movement', r.message.name);\n            }\n        }\n    });\n}\n",
  "view": "Form"
 }
]